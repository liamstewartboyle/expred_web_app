<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="../static/styles/counterfactual.css"/>
    <meta charset="UTF-8">
    <title>Counterfactual Assistant</title>
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
    <!-- VUE3 -->
    <script src="https://unpkg.com/vue@3.0.11/dist/vue.global.js"></script>
    <!-- BS5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- mitt -->
    <script src="https://unpkg.com/mitt/dist/mitt.umd.js"></script>

</head>
<body>

<div>
    <div class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Annotation done</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Annotation is done.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" href='/counterfactual'>Next</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Quit</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class='navbar navbar-expand-lg bg-primary'>
    <div class='container-fluid'>
        <!-- links -->
        <ul class='navbar-nav'>
            <li class='nav-item'>
                <a class='nav-link text-white' href='/'>FaxPlain</a>
            </li>
            <li class='nav-item'>
                <a class='nav-link text-white' href='/counterfactual'>Counter-Assist</a>
            </li>
        </ul>
    </div>
</div>
<div class='container-fluid'>

    <div class='container-fluid pt-3' style='background: #f7f8f9!important' id='app'>
        <div class='row'>
            <div class='col-sm'>
                <div class='mb-1'>
                    <a class='display-7' data-bs-toggle='collapse' href='#introduction'>
                        Introduction...
                    </a>
                    <div class='card card-body container-fluid collapse mb-1' id='introduction'>
                        This is a tool to evaluating the risk of deploying the model in the field using counterfactuals.<br/>
                        The primary output is the reliability/risk of the model and the side-product is a highly-useful counterfactual dataset<br>
                        Users are asked to do the follows:<br>
                        1. Select a sentence from the left column (the range of a sentence is highlighted)<br>
                        2. Once the sentence is selected, the generated counterfactual is presented by the right column<br>
                        &nbsp;&nbsp;2.1. The counterfactual is generated by gradually replacing important words from the chosen sentence. Therefore you will see multiple sentences with their prediction, each with a word replaced. But only the final sentence is nominated as the "Counterfactual" and the prediction is usually flipped<br>
                        3. Then the users are asked to decide whether to accept the counterfactuals generated.
                        &nbsp;&nbsp;3.1 If the final counterfactual is natual in meaning, the user accept it can unfold the "Looks nice, evaluate them" panel and evaluate the result using three scores:<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;3.1.1 The Plausibility score means whether the counterfactual SHOULD imply a clear sentiment polarity (5 for clearly positive or negative and 1 for vague polarity);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;3.1.2 The Meaningfulness score describes whether the counterfactual is a meaningful sentence (5 for most human-readable and 1 for nonsense);<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;3.1.3 The Risk score evaluates whether the model's prediction is wrong (risky), 5 for a definitively wrong prediction (high risk) and 1 for correct prediction (low risk)<br>
                        &nbsp;&nbsp;3.2 If the final counterfactual is not acceptable, the user can unfold the panel "Looks lame, try another strategy" to let the system generate another counterfactual of the current sentence<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;3.2.1. The user can choose the masking strategy, which means based on which words the prediction is made and which words are to replaced. The chosen words are marked bold and are called "important words".<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.1.1. The strategy is by default "ExPred", a default important-word selection algorithm.<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.1.2. By choosing "custom" strategy, the user can toggle the importance of the word from the sentence<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;3.2.2. The "Replacement Retrieving Strategy" means the strategy based on which the new words are chosen
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.2.1. By default the Retrieving Strategy is "HotFlip", which generates counterfactual as fast as possible but the output is not always meaningful<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.2.2.2. The "Masked Language Model" generates highly meaningful counterfactuals but the final prediction on the counterfactuals are not always flipped<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;3.2.3. After selecting your masking and word replacement strategy, the user can click "Try this" to apply the setting and get the next counterfactual<br>
                        4. If you are happy with the current sentence, you can choose another sentence from the current document. Or switch to another document by refresing the current page<br>
                    </div>
                </div>
                <initial-doc
                        :orig_doc="%%orig_doc%%"
                        :explains="%%explains%%"
                        :query="'%%query%%'"
                        :pred="'%%pred%%'"
                        :label="'%%label%%'"
                        :ann_id="'%%ann_id%%'"
                        :is_cf_example_loading="is_cf_example_loading"
                        :pos_img_url="'%%url_for('static', filename='imgs/POS.png')%%'"
                        :neg_img_url="'%%url_for('static', filename='imgs/NEG.png')%%'"></initial-doc>
                <script src="%% url_for('static', filename='counterfactual.js') %%"></script>
                <script src="%% url_for('static', filename='components/initial_doc.js') %%"></script>
            </div>

            <div class='col-sm'>
                <script src="%%url_for('static', filename='components/show_examples.js')%%"></script>
                <div class='h5' v-show="is_cf_example_loading">Loading...</div>
                <div v-if='is_cf_example_ready'>
                    <show-examples
                            :pos_img_url="'%%url_for('static', filename='imgs/POS.png')%%'"
                            :neg_img_url="'%%url_for('static', filename='imgs/NEG.png')%%'"
                            :cf_examples='cf_examples'
                            :session_id="session_id"
                            :query="'%%query%%'"
                            :label="'%%label%%'">
                    </show-examples>
                </div>
                <div v-else></div>
            </div>
            <div class="restrictions row">
            </div>
        </div>
    </div>

    <script>
        const eventBus = mitt()
        app.config.globalProperties.eventBus = eventBus
        const mountedApp = app.mount('#app')

    </script>

</body>
</html>